{"version":3,"file":"menu.mjs","sources":["../../../../../../packages/components/cascader-panel/src/menu.vue"],"sourcesContent":["<template>\n  <el-scrollbar :key=\"menuId\" tag=\"ul\" role=\"menu\" :class=\"ns.b()\" :wrap-class=\"ns.e('wrap')\"\n    :view-class=\"[ns.e('list'), ns.is('empty', isEmpty)]\" @mousemove=\"handleMouseMove\" @mouseleave=\"clearHoverZone\">\n    <!-- 全选按钮 -->\n    <div v-if=\"showSelectAll\" :class=\"ns.e('select-all')\">\n      <el-checkbox :model-value=\"isAllSelected\" :indeterminate=\"isIndeterminate\" @click.stop\n        @update:model-value=\"handleSelectAllChange\">\n        {{ selectAllText }}\n      </el-checkbox>\n    </div>\n\n    <!-- :onVnodeMounted 为什么要添加这个代码? \n     1. index的addNodeByValue 和removeNodeByValue 中 使用的是docheck \n     docheck 并不会触发数据的响应式依赖 vue监听不到  所以在这里添加钩子 搭配list中的 menus.value = [...menus.value] \n     能强制更新视图 但是 性能会下降 -->\n    <el-cascader-node v-for=\"node in nodes\" :key=\"node.uid\" :node=\"node\" :menu-id=\"menuId\" @expand=\"handleExpand\"\n      :onVnodeMounted=\"() => { }\" />\n    <div v-if=\"isLoading\" :class=\"ns.e('empty-text')\">\n      <el-icon size=\"14\" :class=\"ns.is('loading')\">\n        <loading />\n      </el-icon>\n      {{ t('el.cascader.loading') }}\n    </div>\n    <!-- <el-cascader-node v-for=\"node in nodes\" :key=\"node.uid\" :node=\"node\" :menu-id=\"menuId\" @expand=\"handleExpand\"\n        :onVnodeMounted=\"() => logRenderNode(node.uid)\" /> -->\n    <div v-if=\"isLoading\" :class=\"ns.e('empty-text')\">\n      <el-icon size=\"14\" :class=\"ns.is('loading')\">\n        <loading />\n      </el-icon>\n      {{ t('el.cascader.loading') }}\n    </div>\n    <div v-else-if=\"isEmpty\" :class=\"ns.e('empty-text')\">\n      <slot name=\"empty\">{{ t('el.cascader.noData') }}</slot>\n    </div>\n    <!-- eslint-disable-next-line vue/html-self-closing -->\n    <svg v-else-if=\"panel?.isHoverMenu\" ref=\"hoverZone\" :class=\"ns.e('hover-zone')\"></svg>\n  </el-scrollbar>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, getCurrentInstance, inject, ref, onBeforeUnmount, watch, defineExpose } from 'vue'\nimport ElScrollbar from '@element-plus/components/scrollbar'\nimport { useId, useLocale, useNamespace } from '@element-plus/hooks'\nimport { Loading } from '@element-plus/icons-vue'\nimport ElIcon from '@element-plus/components/icon'\nimport ElCascaderNode from './node.vue'\nimport ElCheckbox from '@element-plus/components/checkbox'\nimport { CASCADER_PANEL_INJECTION_KEY } from './types'\nimport { FixedSizeList } from '@element-plus/components/virtual-list'\n\nimport type { default as CascaderNode } from './node'\nimport type { PropType } from 'vue'\nimport type { Nullable } from '@element-plus/utils'\nimport type { CheckboxValueType } from '@element-plus/components/checkbox'\n\nexport default defineComponent({\n  name: 'ElCascaderMenu',\n\n  components: {\n    Loading,\n    ElIcon,\n    ElScrollbar,\n    ElCascaderNode,\n    FixedSizeList,\n    ElCheckbox,\n  },\n\n  props: {\n    nodes: {\n      type: Array as PropType<CascaderNode[]>,\n      required: true,\n    },\n    index: {\n      type: Number,\n      required: true,\n    },\n    modelValue: {\n      type: Object as PropType<{ allSelected: boolean; exceptions: string[] }>,\n      default: () => ({ allSelected: false, exceptions: [] }),\n    },\n  },\n\n  setup(props) {\n    const instance = getCurrentInstance()!\n    const ns = useNamespace('cascader-menu')\n\n    const { t } = useLocale()\n    const id = useId()\n    let activeNode: Nullable<HTMLElement> = null\n    let hoverTimer: Nullable<number> = null\n\n    const panel = inject(CASCADER_PANEL_INJECTION_KEY)!\n\n    const hoverZone = ref<null | SVGSVGElement>(null)\n\n    const isEmpty = computed(() => !props.nodes.length)\n    const isLoading = computed(() => !panel.initialLoaded)\n    const menuId = computed(() => `${id.value}-${props.index}`)\n\n    const handleExpand = (e: MouseEvent) => {\n      console.log(e.target, 'e.target')\n      activeNode = e.target as HTMLElement\n    }\n\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!panel.isHoverMenu || !activeNode || !hoverZone.value) return\n\n      if (activeNode.contains(e.target as HTMLElement)) {\n        clearHoverTimer()\n\n        const el = instance.vnode.el as HTMLElement\n        const { left } = el.getBoundingClientRect()\n        const { offsetWidth, offsetHeight } = el\n        const startX = e.clientX - left\n        const top = activeNode.offsetTop\n        const bottom = top + activeNode.offsetHeight\n\n        hoverZone.value.innerHTML = `\n          <path style=\"pointer-events: auto;\" fill=\"transparent\" d=\"M${startX} ${top} L${offsetWidth} 0 V${top} Z\" />\n          <path style=\"pointer-events: auto;\" fill=\"transparent\" d=\"M${startX} ${bottom} L${offsetWidth} ${offsetHeight} V${bottom} Z\" />\n        `\n      } else if (!hoverTimer) {\n        hoverTimer = window.setTimeout(\n          clearHoverZone,\n          panel.config.hoverThreshold\n        )\n      }\n    }\n\n    const clearHoverTimer = () => {\n      if (!hoverTimer) return\n      clearTimeout(hoverTimer)\n      hoverTimer = null\n    }\n\n    const clearHoverZone = () => {\n      if (!hoverZone.value) return\n      hoverZone.value.innerHTML = ''\n      clearHoverTimer()\n    }\n\n\n\n    // 全选相关计算属性\n    const showSelectAll = computed(() => panel.config.multiple && panel.config.showSelectAll)\n    const selectAllText = computed(() => panel.config.selectAllText || t('el.cascader.selectAll'))\n\n    const batchSelectAll = (checked: boolean) => {\n      const nodes = props.nodes\n      for (const node of nodes) {\n        node.doCheck(checked)\n      }\n    }\n    const isAllSelected = computed(() => {\n      return props.nodes.every(node => node.checked)\n    })\n    const isIndeterminate = computed(() => {\n      return props.nodes.some(node => node.checked) && !props.nodes.every(node => node.checked)\n    })\n    const handleSelectAllChange = (checked: CheckboxValueType) => {\n      batchSelectAll(checked as boolean)\n    }\n\n\n\n    // function logRenderNode(nodeUid: string) {\n    // 这里只做简单打印，实际可统计渲染次数\n    // console.log(`[Cascader] 渲染节点: ${nodeUid}`)\n    // }\n\n    return {\n      ns,\n      panel,\n      hoverZone,\n      isEmpty,\n      isLoading,\n      menuId,\n      t,\n      handleExpand,\n      handleMouseMove,\n      clearHoverZone,\n      handleSelectAllChange,\n      isAllSelected,\n      isIndeterminate,\n      showSelectAll,\n      selectAllText,\n      // logRenderNode\n    }\n  },\n})\n</script>\n"],"names":["_normalizeClass","_withCtx","_createCommentVNode","_openBlock","_createElementBlock","_createVNode","_withModifiers","_createTextVNode","_toDisplayString","_Fragment","_renderList","_createBlock","_renderSlot"],"mappings":"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"}